---
title: "Ara vs AHL induction titration : S010"
author: "Prashant"
date: "Sep 28, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, warning=F, fig.width = 4.12, fig.height = 3.29)
source('./general_functions_plate_reading.R')
```

## User inputs


User inputs for multiple sheets

```{r input data, message=F, results='hide'}
# User inputs: 1. Enter name of the excel file, 2. Name of the data sheet(S) 3. number of rows and columns in plate reader data 4. Title for plots #comment (file name starts in the previous directory of this Rproject)

flnm <- 'S010_Ara vs AHL_26-4-19'

flpath <- str_c('../plate reader data/',flnm,'.xlsx')
fl <- read_plateReader_file(flpath) # load all non empty sheets of the excel file into fl - as a list 
sheet_names <- c( "0 hr","6.75 hr") # list the sheets to be loaded
n_Rows <- 8; 
n_Cols <- 12; 
partial_plate = T; # enter FALSE (F) here when the plate is 8 x 12 but non rectangular
# check the number of rows and columns for first sheet listed below
```

## Data crunching

Copy the tables of GFP, OD, Sample names etc. in excel and run the command below to get it into R
Doing calculations with the tables, relating sample names with the values

```{r data analysis}
table_c0 <- extract_from_given_sheet(sheet_names[1], 8, 6, partial_plate) %>% mutate(Time = '0') %>% mutate(Inducer = 0)  # extracing from each sheet
table_c1 <- extract_from_given_sheet(sheet_names[2], n_Rows, n_Cols, partial_plate) %>% mutate(Time = '6.75') %>% mutate(Inducer = str_replace_all(Inducer, c('Glucose' = '1e-3', 'none' = '1e-4')), Inducer = as.numeric(Inducer)) # select the dose response time/sheet, convert string values into arbitrary numbers (ease of plotting)

merged2 <- bind_rows(table_c0,table_c1) # merge all sheets into 1 table

all_days_table <- merged2 %>% separate(Samples, into = c('category', 'Reporter'), sep = '\\_| \\+ ', remove = F) %>% mutate(Samples  = str_replace(Samples, '(.*)\\_(.*)', '\\2')) # create a category row for controls and integrase plasmid names

remove('table_c0', 'table_c1', 'merged2')

all_days_table$Reporter %<>% fct_relevel('rGFP', "pEMF02", "pSH02", "fGFP", "DH10B") # Change order of plotting reporters
```
## Data tables

Showing raw data and processed data here 

GFP/RFP values
``` {r}
# Not showing anything for now # format with colours etc for good visualization
```


## Plotting

 **Notes**:   
 - *0 inducer has been plotted as 1e-3 and glucose repression as 5e-4 (for ease on logscale)*  
 - *AHL is in uM and Ara is in mM*

Plotting GFP/OD with Inducer

```{r plotting1}
# plotting GFP/OD with Inducer (excludes time 0)
sel_table2 <- all_days_table %>% group_and_summarize_at('GFP/OD') %>% filter(!str_detect(Time, "0")) #%>% filter(!str_detect(Inducer, "s")) # filter neccesary samples for plotting ; by default mean and variance of GFP/RFP column
# WT_baseline = sel_table2 %>% filter(str_detect(Inducer,'0') & str_detect(Time,'25') & str_detect(Samples,'RV01 $')) %>% pull(mean) # find the value for pRV01
# rGFP_baseline = sel_table2 %>% filter(str_detect(Inducer,'0') & str_detect(Time,'25') & str_detect(Samples,'rGFP')) %>% pull(mean) # find the value for rGFP negative control

plt3 <- plot_dose_response(sel_table2)
plt4 <- plt3 %>% format_logscale_y()
plt4
```


Plotting GFP/OD with time : linear scale

```{r plotting2}
# plotting GFP/OD : Linear scales
plt5 <- plt3 %>% format_classic() %>% format_logscale_x()
plt5
```

Plotting GFP/OD with time : zoomed linear scale

```{r plotting3}
# plotting GFP/OD : Linear scales
plt6 <- plt5 + ylim(0,18000)
plt6
```

Plotting GFP/OD with time : zoomed linear scale 0,10000

```{r plotting4}
# plotting GFP/OD : Linear scales
plt7 <- plt5 + ylim(0,10000)
plt7
```
Plotting GFP/OD with time : Background levels : zoomed linear scale 0,500

```{r plotting5}
# plotting GFP/OD : Linear scales
plt8 <- plt5 + ylim(0,500)
plt8
```
