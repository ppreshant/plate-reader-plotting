---
title: "Plate reader plotting : S015c"
author: "Prashant"
date: "June 2, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, warning=F, fig.width = 8, fig.height = 4)
# fig.width = 14/3, fig.height = 11.34/3
source('./general_functions_plate_reading.R')
```

## User inputs


User inputs for multiple sheets

```{r input data, message=F, results='hide'}
# User inputs: 1. Enter name of the excel file, 2. Name of the data sheet(S) to exclude 3. number of rows and columns in plate reader data 4. Title for plots 
# Comment (make sure excel file is in the parent directory of the Rproject file or code)

flnm <- 'S020_18-11-19'
# sheets_to_exclude <- 'analysis|dil' # regular expression for sheets to be excluded

n_Rows <- 8; # default full 96 well plate = 8 rows x 12 columns
n_Cols <- 12; 
# check the number of rows and columns for first sheet listed below

plotting_order <- c("pRV01", "pInt8", "pPK7/8", "pPK7/17","Controls") # order of plotting for samples

flpath <- str_c('../',flnm,'.xlsx')
fl <- read_plateReader_file(flpath) # load all non empty sheets of the excel file into fl - as a list 
# sheet_names <- names(fl) %>% .[!str_detect(., sheets_to_exclude)] # get the list of sheets, exclude 'analysis'
sheet_names <- c("serial dil and lb") # list the sheets to be loaded manually
sheet_times <- sheet_names %>% str_split(' ') %>% unlist() %>% .[rep(c(T,F))] %>% as.numeric() # extracting the hour time from sheet name
# sheet_times <- c(0,6,24,48,72,96) # manual entry of sheet times
```

## Data crunching

Copy the tables of GFP, OD, Sample names etc. in excel and run the command below to get it into R
Doing calculations with the tables, relating sample names with the values

```{r data analysis}
tables_cx <- map2(sheet_names, sheet_times, ~ extract_from_given_sheet(.x, n_Rows, n_Cols) %>% mutate(Time = .y)) # extracing OD, GFP and RFP from each sheet (vectorized)

merged2 <- bind_rows(tables_cx) %>% rename(Dilution = Inducer) %>% mutate(Dilution = as.numeric(paste(Dilution))) # merge all sheets into 1 table

```

## Data tables

Showing raw data and processed data here 

GFP/RFP values
``` {r}
# Not showing anything for now # format with colours etc for good visualization
```


## Plotting


Plotting GFP/OD zoom in to mutants

```{r plotting1od}
sel_table1_OD <- merged2 %>% filter(str_detect(Samples, 'MG')) %>% group_and_summarize_at('OD', Dilution)
plt1_OD <- ggplot(sel_table1_OD, aes(x = Dilution, y = mean)) + geom_point() + geom_line() + scale_x_log10()
plt1_OD
```

]