---
title: "Plate reader plotting : S013"
author: "Prashant"
date: "June 2, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
source('./general_functions_plate_reading.R')
```

## User inputs


User inputs for multiple sheets

```{r input data, echo = F, message = F}
# User inputs: 1. Enter name of the excel file, 2. Name of the data sheet(S) 3. number of rows and columns in plate reader data 4. Title for plots #comment (file name starts in the previous directory of this Rproject)

flnm <- 'S015c_AHL flip timecourse_3-7-19'

flpath <- str_c('../',flnm,'.xlsx')
fl <- read_plateReader_file(flpath) # load all non empty sheets of the excel file into fl - as a list 
sheet_names <- c("0 hr","6 hr","24 hr") # list the sheets to be loaded
n_Rows <- 8; 
n_Cols <- 12; 
# check the number of rows and columns for first sheet listed below

```

## Data crunching

Copy the tables of GFP, OD, Sample names etc. in excel and run the command below to get it into R
Doing calculations with the tables, relating sample names with the values

```{r data analysis, echo=FALSE}
table_c0 <- extract_from_given_sheet(sheet_names[1], 3, 12) %>% mutate(Time = 0) # extracing from each sheet
table_c1 <- extract_from_given_sheet(sheet_names[2], n_Rows, n_Cols) %>% mutate(Time = 6)
table_c2 <- extract_from_given_sheet(sheet_names[3], n_Rows, n_Cols) %>% mutate(Time = 24)

all_days_table <- bind_rows(table_c0,table_c1,table_c2) # merge all sheets into 1 table

all_days_gathered <- all_days_table %>% gather(key = 'Measurement', value = 'Reading', OD, GFP, RFP, 'GFP/RFP')

```

## Data tables

Showing raw data and processed data here 

GFP/RFP values
``` {r}
# merged2 # format with colours etc for good visualization
```


## Plotting

Plotting mean and variance

```{r plotting, echo=T}
sel_table1 <- all_days_table %>% summarize_and_arrange_at() %>% filter(!str_detect(Samples, "MG")) %>% filter(!str_detect(Inducer, "_")) # filter neccesary samples for plotting ; by default mean and variance of GFP/RFP column
sel_table1$Samples %<>% fct_relevel(levels(.)[c(5,4,1,3,2,6)]) # manually reorder sample order for plotting

plt1 <- ggplot(sel_table1, aes(Time, mean, colour = Inducer)) + geom_point(size = 1) +  geom_errorbar(aes(ymin = mean - sd, ymax = mean + sd), width = 0.25) + facet_wrap(~ Samples) + geom_line() + scale_x_continuous(breaks = c(0,6,24)) + ylab('GFP/RFP') + ggtitle('AHL flipping with time') + labs(colour = '[AHL]')
plt2 <- plt1 %>% format_classic() %>% format_logscale()
# ggsave('plots and data/S015_linear.png', plt1)
# ggsave('plots and data/test.png', width = 14/3, height = 11.34/3)
```

Plotting all GFP and RFPs

```{r plotting, echo=T}
sel_table1 <- all_days_gathered %>% filter(!str_detect(Inducer, "_")) # filter neccesary samples for plotting
sel_table1$Samples %<>% fct_relevel(levels(.)[c(5,4,1,3,2,6)]) # manually reorder sample order for plotting

plt3 <- ggplot(sel_table1, aes(Time, Reading, colour = Measurement, shape = Inducer, group = interaction('Replicate #', Inducer, Measurement))) + geom_point(size = 1)  + facet_wrap(~ Samples, scales = 'free_y') + geom_line() + scale_x_continuous(breaks = c(0,6,24)) + ylab('GFP/RFP') + ggtitle('AHL flipping with time') + labs(colour = '[AHL]')
plt4 <- plt3 %>% format_classic() %>% format_logscale()
# ggsave('plots and data/S015_linear.png', plt1)
# ggsave('plots and data/test.png', width = 14/3, height = 11.34/3)
```
