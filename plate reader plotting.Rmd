---
author: "Prashant Kalvapalle"
date: '`r format(Sys.time(), "%d %B, %Y")`'
output: 
  html_document:
    theme: flatly
    toc: TRUE
    toc_float: TRUE
---

---
title: `r title_name`
---

```{r setup, include=FALSE}
library(knitr)
knitr::opts_chunk$set(echo = F, message = F, warning = F, fig.width = 5, fig.height = 4)

```

## Plotting

Note : X and Y are one of pIDV_9 and pSPB868 : the exact order I have to doublecheck in the lab

```{r plot1}
gfp_order_merged2 <- merged2 %>% 
  arrange(GFP) %>% 
  ungroup() %>% 
  mutate(across(Samples, fct_inorder))

gfp_unique_mean <- gfp_order_merged2 %>% 
  select(Samples, contains('mean')) %>% 
  unique()

# plot a horizontal bar graph, along with individual replicates and mean annotated
plt_GFP <- ggplot(data = gfp_order_merged2,
                  mapping = aes(y = Samples, x = GFP)) + 
  geom_jitter(width = 0, height = .3) + # plot individual replicates
  geom_point(data = gfp_unique_mean, # plot mean as a vertical dash (for small point, use size = 0.5)
             aes(x = GFP_mean), size = 5, shape = '|') + 
  geom_bar(data = gfp_unique_mean, 
           aes(x = GFP_mean, y = Samples), alpha = 0.3, fill = 'gray', stat = 'identity',position = 'dodge') +
    # geom_segment(aes(x = GFP_mean, xend = 0, yend = Samples), alpha = 0.1, colour = 'red') + 
  xlab('GFP (a.u)') + ylab('') + ggtitle('Fluorescence measurement', subtitle = 'Plasmids')
  
  {plt_GFP + geom_text(data = merged2 %>% select(ends_with('mean')) %>% unique(),  
              mapping = aes(x = GFP_mean, label = GFP_mean %>% round, 
              hjust = if_else(GFP_mean > max(GFP_mean)/2, 1.3, -0.3)))
  } %>% 
print()

# ggsave(str_c('./plots and data/', title_name, '.png'), width = 5, height = 4) # save plot if necessary

plotly::ggplotly(plt_GFP) %>% plotly::style(textposition = 'top right')

```



```{r plotting, echo=T}

# This is work in progress
# merged4 %>% ggplot(aes(Samples, mean, color = Inducer)) + geom_point(size = 3) + geom_errorbar(aes(ymin = mean - sd, ymax = mean + sd), width = 0.25) + scale_shape_manual(values = c(1,16)) -> plt
# plt %<>% format_classic(.) %>% format_logscale()
# plt <- plt + ggtitle('S013 : RBS library 6.2') + ylab('GFP/RFP')
# ggsave('plots and data/S010_faceted.png', height = 3.5, width = 14)
```

## Data tables

Showing raw data and processed data here 

``` {r}
kable(merged2, caption = 'full data') # format with colours etc for good visualization
```
