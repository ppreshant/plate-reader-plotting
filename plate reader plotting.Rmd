---
title: "Plate reader plotting : S010"
author: "Prashant"
date: "June 2, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
source('./general_functions_plate_reading.R')
```

## Input data


Copy the tables of GFP, OD, Sample names etc. in excel and run the command below to get it into R

```{r input data, echo = F, message = F}
# User inputs: 1. Enter name of the excel file, 2. Name of the data sheet(S) 3. number of rows and columns in plate reader data 4. Title for plots #comment (file name starts in the previous directory of this Rproject)

flnm <- '../S010_Ara vs AHL_26-4-19.xlsx'
fl <- read_plateReader_file(flnm) # load all non empty sheets of the excel file into fl - as a list 
data_sheet1 <- fl$`6.75 hr optimal gain` # extract the sheet of interest (sheet2 is by default the first non-empty sheet unless it was renamed)
nRows <- 8; 
nCols <- 12;

# Context: 24 rows of lines before data is seen, 27 rows between data and fluorescence values, 27 more rows till RFP values
table_OD <- data_sheet1[24 + 0:nRows, 1 + 0:nCols] # exract the OD table
table_Samples <- data_sheet1[24 + 0:nRows, 3 + nCols + 0:nCols] # exract the Sample names table
table_Inducer <- data_sheet1[24 + 0:nRows, 5+2*nCols + 0:nCols] # exract the Inducer table
table_GFP <- data_sheet1[(50+nRows) + 0:nRows, 1 + 0:nCols] # exract the GFP values
table_RFP <- data_sheet1[(76+2*nRows) + 0:nRows,  1 + 0:nCols] # exract the RFP values

tables_list <- list(table_Samples,table_OD,table_GFP,table_RFP,table_Inducer)
names_vector <- c('Samples','OD','GFP','RFP','Inducer')

merged1 <- map2_dfc(tables_list, names_vector, read_plate_to_column) # convert plate tables into columns and merge all four data types into 1 table
```

## Data crunching

Doing calculations with the tables, relating sample names with the values

```{r data analysis, echo=FALSE}
merged2 <- merged1 %>% filter(!str_detect(Samples, "NA"))  # remove NA samples (empty wells)
merged2 %<>% mutate(Samples = as_factor(Samples)) # freeze order of samples as in the plate - columnwise - for easy plotting
```

## Data tables

Showing raw data and processed data here

GFP/RFP values
``` {r}
merged2
```


## Plotting

Plotting

```{r plotting, echo=T}
merged2 %>% ggplot(aes(Inducer,GFP, color = Samples)) + geom_point() + facet_wrap(~Samples, scales = 'free_x') -> plt
plt %<>% format_classic(.) %>% format_logscale()
# ggsave('plots and data/S010_faceted.png', height = 3.5, width = 14)
```
